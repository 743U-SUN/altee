# Markdown Preview ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

ã“ã®ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ã¯ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’HTMLã«å¤‰æ›ã—ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚GitHubé¢¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¨çµµæ–‡å­—ã‚µãƒãƒ¼ãƒˆã‚’æä¾›ã—ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®åˆ‡ã‚Šæ›¿ãˆã‚‚ç°¡å˜ã«è¡Œãˆã‚‹ã‚ˆã†ã«è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚

## æ©Ÿèƒ½

- **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼**: ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆå¼ã§ã‚¨ãƒ‡ã‚£ã‚¿ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
- **GitHubé¢¨è¨˜æ³•**: ãƒ†ãƒ¼ãƒ–ãƒ«ã€ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã€å–ã‚Šæ¶ˆã—ç·šãªã©ã‚’ã‚µãƒãƒ¼ãƒˆ
- **çµµæ–‡å­—ã‚µãƒãƒ¼ãƒˆ**: `:smile:` â†’ ğŸ˜„ ãªã©ã®å¤‰æ›
- **ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆ**: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ç¾ã—ã„è¡¨ç¤º
- **è‡ªå‹•ä¿å­˜**: 1ç§’é–“ã®å…¥åŠ›åœæ­¢å¾Œã«è‡ªå‹•ã§LocalStorageã«ä¿å­˜
- **ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: .mdãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã¨æ›¸ãå‡ºã—
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å¯¾å¿œæº–å‚™æ¸ˆã¿**: ç°¡å˜ã«DBã«åˆ‡ã‚Šæ›¿ãˆå¯èƒ½

## ä½¿ã„æ–¹

### åŸºæœ¬æ“ä½œ

1. **ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¢ãƒ¼ãƒ‰**: ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›
2. **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰**: ã‚¿ãƒ–ã‚’åˆ‡ã‚Šæ›¿ãˆã¦HTMLè¡¨ç¤ºã‚’ç¢ºèª
3. **ä¿å­˜**: è‡ªå‹•ä¿å­˜ã¾ãŸã¯Saveãƒœã‚¿ãƒ³ã§æ‰‹å‹•ä¿å­˜
4. **ã‚¤ãƒ³ãƒãƒ¼ãƒˆ**: Import ãƒœã‚¿ãƒ³ã§.mdãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
5. **ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: Export ãƒœã‚¿ãƒ³ã§.mdãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
6. **ã‚¯ãƒªã‚¢**: Clear ãƒœã‚¿ãƒ³ã§å…¨å†…å®¹ã‚’å‰Šé™¤

### ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•

#### åŸºæœ¬è¨˜æ³•
```markdown
# è¦‹å‡ºã—1
## è¦‹å‡ºã—2
### è¦‹å‡ºã—3

**å¤ªå­—** *æ–œä½“* ~~å–ã‚Šæ¶ˆã—ç·š~~

- ãƒªã‚¹ãƒˆé …ç›®1
- ãƒªã‚¹ãƒˆé …ç›®2

1. ç•ªå·ä»˜ããƒªã‚¹ãƒˆ
2. é …ç›®2

[ãƒªãƒ³ã‚¯](https://example.com)

![ç”»åƒ](https://example.com/image.png)
```

#### GitHubé¢¨æ‹¡å¼µè¨˜æ³•
```markdown
| åˆ—1 | åˆ—2 | åˆ—3 |
|-----|-----|-----|
| ãƒ‡ãƒ¼ã‚¿1 | ãƒ‡ãƒ¼ã‚¿2 | ãƒ‡ãƒ¼ã‚¿3 |

- [x] å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯
- [ ] æœªå®Œäº†ã®ã‚¿ã‚¹ã‚¯

```javascript
function hello() {
  console.log("Hello, World!");
}
```

:smile: :heart: :thumbsup: (çµµæ–‡å­—)
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 
```
app/mdpreview/
â”œâ”€â”€ page.tsx              # ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”œâ”€â”€ components/           # UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ MarkdownWorkspace.tsx
â”‚   â”œâ”€â”€ MarkdownEditor.tsx
â”‚   â”œâ”€â”€ MarkdownPreview.tsx
â”‚   â””â”€â”€ TabNavigation.tsx
â”œâ”€â”€ hooks/               # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ useMarkdownStorage.ts
â”‚   â””â”€â”€ useTabState.ts
â”œâ”€â”€ lib/                 # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ markdown-processor.ts
â”‚   â”œâ”€â”€ storage-adapter.ts
â”‚   â””â”€â”€ server-actions.ts
â”œâ”€â”€ types/               # å‹å®šç¾©
â”‚   â””â”€â”€ index.ts
â””â”€â”€ mdpreview-guide.md   # ã“ã®ã‚¬ã‚¤ãƒ‰
```

### ä¸»è¦ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

- **MarkdownWorkspace**: ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ
- **TabNavigation**: ã‚¨ãƒ‡ã‚£ã‚¿/ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼åˆ‡ã‚Šæ›¿ãˆ
- **MarkdownEditor**: ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã‚¨ãƒªã‚¢
- **MarkdownPreview**: HTMLå¤‰æ›çµæœè¡¨ç¤º

### ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯

- **useMarkdownStorage**: ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ï¼ˆè‡ªå‹•ä¿å­˜ã€æ‰‹å‹•ä¿å­˜ã€èª­ã¿è¾¼ã¿ï¼‰
- **useTabState**: URLçŠ¶æ…‹ç®¡ç†ï¼ˆnuqsä½¿ç”¨ï¼‰

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã®åˆ‡ã‚Šæ›¿ãˆæ–¹æ³•

ç¾åœ¨ã¯LocalStorageã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€ä»¥ä¸‹ã®æ‰‹é †ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åˆ‡ã‚Šæ›¿ãˆã§ãã¾ã™ï¼š

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«ã®è¨­å®š

Prismaä½¿ç”¨ä¾‹ï¼š
```prisma
model MarkdownDocument {
  id          String   @id @default(cuid())
  title       String?
  content     String
  userId      String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

### 2. Server Actionsã®å®Ÿè£…

`lib/server-actions.ts` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ï¼š

```typescript
'use server'

import { prisma } from '@/lib/prisma'
import { auth } from '@/lib/auth'
import { DatabaseDocument } from '../types'

export async function createDocument(
  content: string, 
  title?: string
): Promise<DatabaseDocument> {
  const session = await auth()
  if (!session?.user?.id) throw new Error('Unauthorized')

  const document = await prisma.markdownDocument.create({
    data: {
      content,
      title: title || 'Untitled',
      userId: session.user.id
    }
  })

  return {
    id: document.id,
    title: document.title,
    content: document.content,
    userId: document.userId,
    createdAt: document.createdAt,
    updatedAt: document.updatedAt,
    lastModified: document.updatedAt
  }
}

// updateDocument, getDocument, deleteDocument, listDocuments ã‚‚åŒæ§˜ã«å®Ÿè£…
```

### 3. DatabaseAdapterã®å®Ÿè£…

`lib/storage-adapter.ts` ã® DatabaseAdapter ã‚’å®Ÿè£…ï¼š

```typescript
import { createDocument, updateDocument, getDocument } from './server-actions'

export class DatabaseAdapter implements StorageAdapter {
  constructor(private documentId?: string) {}

  async save(content: string): Promise<void> {
    if (this.documentId) {
      await updateDocument(this.documentId, content)
    } else {
      const doc = await createDocument(content)
      this.documentId = doc.id
    }
  }

  async load(): Promise<string> {
    if (!this.documentId) return ''
    const doc = await getDocument(this.documentId)
    return doc?.content || ''
  }

  async clear(): Promise<void> {
    if (this.documentId) {
      await deleteDocument(this.documentId)
      this.documentId = undefined
    }
  }
}
```

### 4. ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼åˆ‡ã‚Šæ›¿ãˆ

`lib/storage-adapter.ts` ã® `createStorageAdapter` é–¢æ•°ã‚’ä¿®æ­£ï¼š

```typescript
export function createStorageAdapter(documentId?: string): StorageAdapter {
  // ç’°å¢ƒå¤‰æ•°ã‚„è¨­å®šã§åˆ‡ã‚Šæ›¿ãˆ
  const useDatabase = process.env.NEXT_PUBLIC_USE_DATABASE === 'true'
  
  if (useDatabase) {
    return new DatabaseAdapter(documentId)
  }
  return new LocalStorageAdapter()
}
```

## é–‹ç™ºãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ã‚¹ã‚¿ã‚¤ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯ `MarkdownPreview.tsx` ã® `prose` ã‚¯ãƒ©ã‚¹ã§åˆ¶å¾¡ã•ã‚Œã¦ã„ã¾ã™ï¼š

```tsx
<div className="prose prose-sm max-w-none dark:prose-invert">
  {/* ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
</div>
```

### ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã®å¤‰æ›´

`MarkdownPreview.tsx` ã§ãƒ†ãƒ¼ãƒã‚’å¤‰æ›´ï¼š

```tsx
import { github, githubDark, vs, vsDark } from 'react-syntax-highlighter/dist/esm/styles/prism'

// ãƒ†ãƒ¼ãƒã®åˆ‡ã‚Šæ›¿ãˆ
const theme = isDarkMode ? githubDark : github
```

### ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®è¿½åŠ 

æ–°ã—ã„remark/rehypeãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’è¿½åŠ ã™ã‚‹å ´åˆï¼š

1. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
2. `MarkdownPreview.tsx` ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆãƒ»è¨­å®š
3. `lib/markdown-processor.ts` ã§è¨­å®šã‚’ç®¡ç†

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **ä¿å­˜ã•ã‚Œãªã„**: ãƒ–ãƒ©ã‚¦ã‚¶ã®LocalStorageãŒç„¡åŠ¹ã«ãªã£ã¦ã„ã‚‹å¯èƒ½æ€§
2. **ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„**: react-markdownã®ä¾å­˜é–¢ä¿‚ã‚’ç¢ºèª
3. **ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆãŒåŠ¹ã‹ãªã„**: è¨€èªåã¨ãƒã‚¤ãƒ©ã‚¤ã‚¿ãƒ¼ã®ã‚µãƒãƒ¼ãƒˆè¨€èªã‚’ç¢ºèª

### ãƒ‡ãƒãƒƒã‚°

é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã®Consoleã§LocalStorageã®å†…å®¹ã‚’ç¢ºèªï¼š
```javascript
localStorage.getItem('mdpreview-content')
```

## ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®ä½¿ç”¨

ã“ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯ä»–ã®Next.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚ç°¡å˜ã«ä½¿ç”¨ã§ãã¾ã™ï¼š

1. `app/mdpreview/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã‚³ãƒ”ãƒ¼
2. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š
   ```bash
   npm install react-markdown remark-gfm remark-emoji react-syntax-highlighter rehype-sanitize nuqs
   ```
3. shadcn/uiã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒåˆ©ç”¨å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª
4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¦ä»¶ã«å¿œã˜ã¦ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã‚’è¨­å®š

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ã‚³ãƒ¼ãƒ‰ã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§è‡ªç”±ã«ä½¿ç”¨ãƒ»æ”¹å¤‰ã§ãã¾ã™ã€‚